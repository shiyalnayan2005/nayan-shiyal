{% liquid
  # --------- For CSS ----------#
  # main section selector
  # assign sec_sel = '#shopify-section-' | append: section.id
  assign mobile_point = 768
%}

{%- style -%}
  .ecom-row-items {
    display: flex;
    justify-content: space-between;
    align-items: center;
    text-align: center;
    gap: 50px;
    padding: 10px 50px;
    background: #F5F5F5;
    position: relative;
  }

  .ecom-row-items .ecom-logo-box .img-wrapper {
    display: flex;
  }
  .ecom-text {
    margin: 0;
    font-family: "Jost";
    font-weight: normal;
    font-size: 16px;
    line-height: 14px;
  }

  /* Start : Button Style */

  .ecom-btn {
    --color-text: #000;
    --color-bg: #FFF544;
    --color-hover: #000;
    --color-hover-text: #F5F5F5;

    font-family: 'Jost';
    font-size: 16px;
    font-weight: 400;
    text-transform: uppercase;
    line-height: 20px;
    letter-spacing: 0px;
    display: flex;
    justify-content: flex-end;
    align-items: center;
    text-align: center;
    gap: 18px;
    margin: 0;
    padding: 12px 22px;
    width: 100%;
    max-width: fit-content;
    border: none;
    background: var(--color-bg);
    cursor: pointer;
    position: relative;
    transition: all 0.4s cubic-bezier(0.25, 0.46, 0.45, 0.94);
    z-index: 1;
  }

  .ecom-btn .svg-wrapper {
    width: 24px;
    height: fit-content;
    position: relative;
  }

  .ecom-btn .svg-wrapper svg {
    width: 100%;
    height: fit-content;
    transition: all 0.4s cubic-bezier(0.25, 0.46, 0.45, 0.94);
  }

  .ecom-btn::before {
    content: '';
    position: absolute;
    top: 0;
    left: 0;
    width: 0;
    height: 100%;
    background: var(--color-hover);
    opacity: 0;
    transition: all 0.4s cubic-bezier(0.25, 0.46, 0.45, 0.94);
    z-index: -1;
  }
  .ecom-btn:hover {
    color: var(--color-hover-text);
    box-shadow: 0 4px 8px rgba(0, 0, 0, 0.1);
  }

  .ecom-btn:hover::before {
    width: 100%;
    opacity: 1;
  }

  .ecom-btn:active {
    transform: scale(0.98);
    opacity: 0.82;
  }

  .ecom-btn.ecom-btn-black {
    background: #000000;
    color: #F5F5F5;
  }
  .ecom-btn.ecom-btn-black:hover {
    background: #FFF544;
    color: #000000;
  }

  /* End : Button Style */

  .ecom-top-row .ecom-btn {
    max-width: 207px;
  }

  .empty-btn-space {
    display: inline-block;
    width: 18px;
    height: 10px;
    pointer-events: none;
    flex-shrink: 0;
  }
  .ecom-menu-toggler {
    margin: 0;
    padding: 0;
    border: none;
    box-shadow: none;
    outline: none;
    background: transparent;
    display: flex;
    justify-content: center;
    align-items: center;
    width: 18px;
    height: 18px;
    cursor: pointer;
    flex-shrink: 0;
    position: relative;
  }
  .ecom-menu-toggler .svg-wrapper {
    display: flex;
    width: 100%;
    height: 100%;
    opacity: 1;
    transition: opacity 0.4s ease-in;
    position: absolute;
    top: 50%;
    left: 50%;
    transform: translate(-50%, -50%);
  }
  .ecom-menu-toggler .svg-wrapper.icon-close {
    width: 13px;
    height: 13px;
  }
  .ecom-menu-toggler[aria-expanded='true'] .icon-close,
  .ecom-menu-toggler[aria-expanded='false'] .icon-default {
    opacity: 1;
  }
  .ecom-menu-toggler[aria-expanded='true'] .icon-default,
  .ecom-menu-toggler[aria-expanded='false'] .icon-close{
    opacity: 0;
  }

  .ecom-menu-drawer {
    height: 0;
    width: 100%;
    overflow: hidden;
    transition: height 0.4s ease-in-out;
    background-color: #F2F2F2;
    box-shadow: inset 0px 2px 4px 0px #00000026;
  }
  .ecom-menu-items {
    display: flex;
    flex-direction: column;
    justify-content: center;
    align-items: center;
    gap: 16px;
    padding: 25px 16px;
  }

  @media(max-width: {{ mobile_point }}px) {
    .ecom-row-items {
      padding: 23px 16px;
      gap: 16px;
    }
    .ecom-top-row .ecom-btn {
      max-width: 244px;
    }
  }

  @media(min-width: {{ mobile_point | plus: 1 }}px) {
    .ecom-hide--desk {
      display: none;
    }
  }
  @media(max-width: {{ mobile_point }}px) {
    .ecom-hide--mobile {
      display: none;
    }
  }
{%- endstyle -%}

<div class="ecom-section">
  <div class="ecom-container">
    {% for block in section.blocks %}
      {% assign blk_set = block.settings %}

      {% case block.type %}
        {% when 'top_row' %}
          <div class="ecom-top-row" {{ block.shopify_attributes }}>
            <div class="ecom-row-items">
              <button
                class="ecom-menu-toggler ecom-hide--desk"
                aria-expanded="false"
                aria-controls="ecom-menu-drawer"
                id="ecom-menu-btn"
              >
                <span class="svg-wrapper icon-default">
                  {{ 'icon-menu-new.svg' | inline_asset_content }}
                </span>
                <span class="svg-wrapper icon-close">
                  {{ 'icon-close.svg' | inline_asset_content }}
                </span>
              </button>

              {%- if blk_set.img != blank -%}
                <div class="ecom-logo-box">
                  <div class="img-wrapper" style="max-width:{{ blk_set.img_width }}px">
                    {%- assign img_alt = blk_set.img_alt | default: blk_set.img.alt -%}
                    {{ blk_set.img | image_url: width: blk_set.img_width | image_tag: alt: img_alt }}
                  </div>
                </div>
              {%- endif -%}
              {%- if blk_set.text != blank -%}
                <p class="ecom-text ecom-hide--mobile">{{ blk_set.text }}</p>
              {%- endif -%}
              {%- if blk_set.btn_label != blank -%}
                {%- if blk_set.btn_url != blank -%}
                  <a href="{{ blk_set.btn_url }}" class="ecom-btn ecom-hide--mobile">
                    <span>{{ blk_set.btn_label }}</span>
                    <span class="svg-wrapper">
                      {{- 'icon-long-arrow-right.svg' | inline_asset_content -}}
                    </span>
                  </a>
                {%- else -%}
                  <button type="button" class="ecom-btn ecom-hide--mobile">
                    <span>{{ blk_set.btn_label }}</span>
                    <span class="svg-wrapper">
                      {{- 'icon-long-arrow-right.svg' | inline_asset_content -}}
                    </span>
                  </button>
                {%- endif -%}
              {%- endif -%}
              <div class="ecom-hide--desk empty-btn-space"></div>
            </div>
            <div
              class="ecom-menu-drawer ecom-hide--desk"
              id="ecom-menu-drawer"
              role="region"
              aria-labelledby="ecom-menu-btn"
              hidden
            >
              <div class="ecom-menu-items">
                {%- if blk_set.text != blank -%}
                  <p class="ecom-text">{{ blk_set.text }}</p>
                {%- endif -%}

                {%- if blk_set.btn_label != blank -%}
                  {%- if blk_set.btn_url != blank -%}
                    <a href="{{ blk_set.btn_url }}" class="ecom-btn">
                      <span>{{ blk_set.btn_label }}</span>
                      <span class="svg-wrapper">
                        {{- 'icon-long-arrow-right.svg' | inline_asset_content -}}
                      </span>
                    </a>
                  {%- else -%}
                    <button type="button" class="ecom-btn">
                      <span>{{ blk_set.btn_label }}</span>
                      <span class="svg-wrapper">
                        {{- 'icon-long-arrow-right.svg' | inline_asset_content -}}
                      </span>
                    </button>
                  {%- endif -%}
                {%- endif -%}
              </div>
            </div>
          </div>

        {% else %}

      {% endcase %}
    {% endfor %}
  </div>
</div>

<script>
  (function () {
    const button = document.querySelector('.ecom-menu-toggler');
    const drawer = document.querySelector('.ecom-menu-drawer');

    if (!button || !drawer) return;

    // Click handler
    button.addEventListener('click', function (e) {
      e.preventDefault();
      toggleAccordion();
    });

    // Keyboard handlers
    button.addEventListener('keydown', function (e) {
      if (e.key === 'Enter' || e.key === ' ') {
        e.preventDefault();
        toggleAccordion();
      }

      if (e.key === 'ArrowDown' && button.getAttribute('aria-expanded') === 'true') {
        e.preventDefault();
        const focusableElements = drawer.querySelectorAll('button, a, [tabindex]:not([tabindex="-1"])');
        if (focusableElements.length > 0) {
          focusableElements[0].focus();
        }
      }
    });

    drawer.addEventListener('transitionend', function (e) {
      if (button.getAttribute('aria-expanded') === 'false') {
        drawer.setAttribute('hidden', '');
      }
    });

    drawer.addEventListener('keydown', function (e) {
      if (e.key === 'Escape' && !drawer.hasAttribute('hidden')) {
        e.preventDefault();
        toggleAccordion();
        button.focus();
      }
    });

    const resizeObserver = new ResizeObserver((entries) => {
      if (button.getAttribute('aria-expanded') === 'false') return;
      for (const entry of entries) {
        drawer.style.height = `${entry.target.scrollHeight}px`;
      }
    });
    resizeObserver.observe(drawer.firstElementChild);

    const mobileSize = parseInt({{ mobile_point }}) + 1;
    window.addEventListener("resize", ()=>{
      if(window.innerWidth > mobileSize && button.getAttribute('aria-expanded') === 'true') {
        toggleAccordion();
      }
    });

    function toggleAccordion() {
      const isExpanded = button.getAttribute('aria-expanded') === 'true';

      button.setAttribute('aria-expanded', !isExpanded);

      if (!isExpanded) {
        drawer.removeAttribute('hidden');
        drawer.style.height = `${drawer.scrollHeight}px`;
      } else {
        drawer.style.height = '0px';
      }
    }
  })();
</script>

{% schema %}
{
  "name": "Ecom Banner Section",
  "settings": [],
  "blocks": [
    {
      "type": "top_row",
      "name": "Top Row",
      "limit": 1,
      "settings": [
        {
          "type": "header",
          "content": "Image Settings"
        },
        {
          "type": "image_picker",
          "id": "img",
          "label": "logo"
        },
        {
          "type": "text",
          "id": "img_alt",
          "label": "accessible name",
          "default": "Visite TASSO VISION"
        },
        {
          "type": "number",
          "id": "img_width",
          "label": "width",
          "default": 151,
          "info": "used with unit px. e.g. 151px"
        },
        {
          "type": "header",
          "content": "Text Settings"
        },
        {
          "type": "text",
          "id": "text",
          "label": "message",
          "default": "Find the ideal gift for your loved ones."
        },
        {
          "type": "header",
          "content": "Button Settings"
        },
        {
          "type": "text",
          "id": "btn_label",
          "label": "button label",
          "default": "choose gift"
        },
        {
          "type": "url",
          "id": "btn_url",
          "label": "url",
          "info": "button work as a link if added."
        }
      ]
    }
  ],
  "presets": [{ "name": "Ecom Banner Section" }]
}
{% endschema %}
